<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Video Compressor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0c10;--card:#141822;--border:rgba(255,255,255,.1);--txt:#e6eaf1;--muted:#9aa7b5;--hi:#39e7ff}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:760px;margin:0 auto;padding:28px 16px 60px}
    h1{margin:6px 0 18px;font-size:clamp(22px,6vw,40px)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px}
    .drop{display:grid;place-items:center;border:2px dashed var(--border);border-radius:14px;padding:30px;min-height:150px;text-align:center}
    .drop.drag{border-color:var(--hi)}
    .big{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#10141e;color:#fff;text-decoration:none;font-weight:600;cursor:pointer}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);cursor:pointer;user-select:none}
    .pill input{accent-color:#00e5ff}
    input[type=number],input[type=text],select{background:#0f1320;color:#f1f5fb;border:1px solid var(--border);border-radius:10px;padding:8px 10px}
    .progress{height:10px;background:#0f1320;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#00e5ff,#ff4aa2);width:0%}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}
    .muted{color:var(--muted)}
    .actions{display:flex;gap:10px;align-items:center;margin-top:12px}
    button.primary{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#0d93b5;color:#fff;font-weight:700}
    button.primary[disabled]{opacity:.6}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Simple Video Compressor</h1>
    <div class="card">
      <div id="drop" class="drop">
        <div>
          <div style="font-weight:700">Drag & drop a video (MP4/MOV/WebM)</div>
          <div class="muted" style="margin:6px 0 10px">Tip: 720p is usually enough for web backgrounds.</div>
          <label class="big">
            Choose file
            <input id="file" type="file" accept="video/*" hidden />
          </label>
          <div id="fname" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <div class="row" style="margin-top:16px">
        <label class="pill"><input type="radio" name="preset" value="mp4-720" checked> MP4 • 720p (H.264)</label>
        <label class="pill"><input type="radio" name="preset" value="mp4-1080"> MP4 • 1080p (H.264)</label>
        <label class="pill"><input type="radio" name="preset" value="webm-720"> WebM • 720p (VP9)</label>
        <label class="pill"><input type="radio" name="preset" value="custom"> Custom</label>
      </div>

      <div class="row">
        <div>
          <div class="muted mono">Width × Height</div>
          <input id="w" type="number" value="1280" style="width:96px"> ×
          <input id="h" type="number" value="720" style="width:96px">
        </div>
        <div>
          <div class="muted mono">Video bitrate</div>
          <input id="vb" type="text" value="4M" style="width:120px">
        </div>
        <div>
          <div class="muted mono">Format</div>
          <select id="fmt"><option value="mp4">mp4</option><option value="webm">webm</option></select>
        </div>
      </div>

      <div class="actions">
        <button id="go" class="primary" disabled>Compress</button>
        <div id="status" class="muted mono"></div>
      </div>

      <div style="margin:12px 0" class="progress"><div id="bar" class="bar"></div></div>
      <div id="out"></div>
    </div>

    <p class="muted mono" style="margin-top:14px">Rule of thumb: 720p → 3–5 Mbps, 1080p → 6–10 Mbps. Smaller bitrate = smaller file.</p>
  </div>

  <!-- ffmpeg.wasm UMD build -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.umd.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      log: false,
      corePath: 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js'
    });

    const $ = (id)=>document.getElementById(id);
    const drop = $('drop');
    const finput = $('file');
    const fname = $('fname');
    const go = $('go');
    const bar = $('bar');
    const out = $('out');
    const status = $('status');
    const w = $('w'); const h = $('h'); const vb = $('vb'); const fmt = $('fmt');

    // Presets
    const radios = Array.from(document.querySelectorAll('input[name="preset"]'));
    const applyPreset = () => {
      const v = radios.find(r=>r.checked).value;
      if (v==='mp4-720'){ w.value=1280; h.value=720; vb.value='4M'; fmt.value='mp4'; }
      if (v==='mp4-1080'){ w.value=1920; h.value=1080; vb.value='8M'; fmt.value='mp4'; }
      if (v==='webm-720'){ w.value=1280; h.value=720; vb.value='2500k'; fmt.value='webm'; }
    };
    radios.forEach(r=>r.addEventListener('change', applyPreset));
    applyPreset();

    // Drag & drop / choose
    const setFile = (file)=>{ finput.file=file; fname.textContent=file.name; go.disabled=false; };
    drop.addEventListener('dragover', e=>{e.preventDefault(); drop.classList.add('drag');});
    drop.addEventListener('dragleave', ()=> drop.classList.remove('drag'));
    drop.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('drag'); if(e.dataTransfer.files[0]) setFile(e.dataTransfer.files[0]); });
    finput.addEventListener('change', e=>{ if(e.target.files[0]) setFile(e.target.files[0]); });

    FFmpeg.setProgress && ffmpeg.setProgress(({ ratio })=>{ bar.style.width = `${Math.round((ratio||0)*100)}%`; });

    async function ensureFF(){
      if(!ffmpeg.isLoaded()){ status.textContent = 'Loading engine…'; await ffmpeg.load(); status.textContent=''; }
    }

    async function compress(){
      try{
        go.disabled=true; bar.style.width='0%'; out.innerHTML='';
        await ensureFF();
        const file = finput.file || finput.files[0];
        if(!file){ alert('Choose a video first.'); go.disabled=false; return; }
        const inName = 'in';
        const isMP4 = fmt.value==='mp4';
        const outName = isMP4 ? 'output.mp4' : 'output.webm';
        ffmpeg.FS('writeFile', inName, await fetchFile(file));
        const scale = `scale=${parseInt(w.value)||1280}:${parseInt(h.value)||720}:force_original_aspect_ratio=decrease`;
        status.textContent='Compressing…';
        const args = isMP4
          ? ['-i',inName,'-vf',scale,'-c:v','libx264','-preset','veryfast','-b:v',vb.value||'4M','-pix_fmt','yuv420p','-movflags','+faststart','-c:a','aac','-b:a','128k',outName]
          : ['-i',inName,'-vf',scale,'-c:v','libvpx-vp9','-b:v',vb.value||'2500k','-c:a','libopus','-b:a','96k',outName];
        await ffmpeg.run(...args);
        const data = ffmpeg.FS('readFile', outName);
        const blob = new Blob([data.buffer], {type: isMP4?'video/mp4':'video/webm'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download=outName; a.textContent=`Download ${outName}`; a.className='big'; out.appendChild(a);
        const info=document.createElement('div'); info.className='mono muted'; info.style.marginTop='6px'; info.textContent=`Output size: ${(blob.size/1024).toFixed(1)} KB`; out.appendChild(info);
        status.textContent='Done.';
      }catch(err){ console.error(err); status.textContent='Error: '+err.message; }
      finally{ go.disabled=false; if(bar.style.width!=='100%') bar.style.width='100%'; }
    }

    go.addEventListener('click', compress);
  </script>
</body>
</html>
